package com.malwarebytes.services;

import com.malwarebytes.model.Card;
import com.malwarebytes.model.CardInfo;
import io.dropwizard.testing.junit5.DropwizardExtensionsSupport;
import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;


@ExtendWith(DropwizardExtensionsSupport.class)
public class EncryptionServiceTest {
    private EncryptionService encryptionService;
    private CardInfo cardInfo;
    private static final String TRANSACTION_ID = "770975262825709568";
    private Card card;

    @BeforeEach
    public void setup(){
        encryptionService = new EncryptionService();
        card = new Card("1234567890", "01/22", "123");
        cardInfo = CardInfo.builder()
                .cardCVV("123")
                .cardNumber("1234567890")
                .expirationDate("01/22")
                .transactionId(TRANSACTION_ID)
                .build();
    }

    @Test
    public void test_encryptCorrectly() throws Exception{
        final String key = encryptionService.generateKey(32);

        String token = encryptionService.tokenize(cardInfo, key);
        Card decryptedCard = encryptionService.deTokenize(token, key);
        Assertions.assertEquals(card.getCardCVV(), decryptedCard.getCardCVV());
        Assertions.assertEquals(card.getCardNumber(), decryptedCard.getCardNumber());
        Assertions.assertEquals(card.getExpirationDate().replace("/", ""), decryptedCard.getExpirationDate());
    }

}
