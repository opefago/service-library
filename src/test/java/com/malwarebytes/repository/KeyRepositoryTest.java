package com.malwarebytes.repository;

import io.lettuce.core.RedisClient;
import org.junit.jupiter.api.AfterEach;
import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import redis.embedded.RedisServer;


public class KeyRepositoryTest {
    private static final String address = "redis://localhost";
    private static RedisServer redisServer;
    private static RedisClient client;
    private KeyRepository keyRepository;
    @BeforeEach
    public void setup() throws Exception{
        redisServer = new RedisServer();
        redisServer.start();
        client = RedisClient.create(address);
        keyRepository = new KeyRepository(client.connect());
    }

    @AfterEach
    public void tearDown(){
        if (client != null)
            client.shutdown();

        if (redisServer != null)
            redisServer.stop();
    }


    @Test
    public void test_insertItemIntoRepository() throws Exception{
        keyRepository.setKey("key", "value");
        Assertions.assertEquals("value",keyRepository.getKey("key"));
    }
}
